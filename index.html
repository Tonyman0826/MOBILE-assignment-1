<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>主題清單</title>
    <!-- Ionic CDN -->
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"
    ></script>
    <script
      nomodule
      src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css"
    />
    <style>
      /* ===== 基礎樣式 ===== */
      .item-content {
        width: 100%;
      }
      
      .item-title {
        font-weight: bold;
        margin: 0.25rem 0;
      }
      
      .item-subtitle {
        color: var(--ion-color-medium);
        font-size: 0.9em;
      }
      
      .tag-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      /* ===== 配色系統 ===== */
      :root {
        --primary-color: #3880ff;
        --primary-light: #e8f2ff;
        --secondary-color: #3dc2ff;
        --success-color: #2dd36f;
        --success-light: #e8f8ef;
        --warning-color: #ffc409;
        --warning-light: #fff8e6;
        --danger-color: #eb445a;
        --danger-light: #ffe8f0;
        --info-color: #7044ff;
        --info-light: #f0ebff;
      }

      /* 應用配色 */
      .list-item {
        background: white;
        border: 1px solid #f0f0f0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border-radius: 8px;
        margin: 4px 8px;
        transition: all 0.3s ease;
      }

      .item-title {
        color: #1a1a1a;
        font-weight: 600;
      }

      .item-subtitle {
        color: #666;
      }

      .item-details {
        color: #666;
        line-height: 1.5;
      }

      /* 標籤配色 */
      .tag-container ion-chip {
        --background: var(--primary-light);
        --color: var(--primary-color);
        border: 1px solid rgba(56, 128, 255, 0.3);
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .tag-container ion-chip:active {
        --background: var(--primary-color);
        --color: white;
        transform: scale(0.95);
      }

      /* 工具欄配色 */
      ion-toolbar {
        --background: var(--primary-color);
        --color: white;
      }

      /* 搜索欄美化 */
      ion-searchbar {
        --border-radius: 25px;
        --box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      }

      /* 空狀態設計 */
      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--ion-color-medium);
      }

      .empty-state ion-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        color: var(--primary-color);
        opacity: 0.7;
      }

      /* 錯誤訊息樣式 */
      .error-message {
        margin: 1rem;
        animation: fadeIn 0.3s ease-out;
      }

      /* 載入狀態 */
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      .loading-spinner {
        text-align: center;
        padding: 2rem;
      }

      /* 篩選狀態 */
      .filter-status {
        background: linear-gradient(135deg, var(--primary-light), white);
        border-bottom: 2px solid var(--primary-color);
      }

      .filter-status ion-item {
        --background: transparent;
        --color: var(--primary-color);
      }

      /* ===== 響應式設計 ===== */
      
      /* 中型螢幕 (768px以上) */
      @media (min-width: 768px) {
        .list-item {
          --padding-start: 1.5rem;
          --padding-end: 1.5rem;
          margin: 6px 12px;
        }
        
        .item-title {
          font-size: 1.1rem;
        }
        
        .list-item:hover {
          background: var(--primary-light);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
      }

      /* 大型螢幕 (992px以上) */
      @media (min-width: 992px) {
        ion-app {
          max-width: 1200px;
          margin: 0 auto;
        }
        
        .list-item {
          --padding-start: 2rem;
          --padding-end: 2rem;
          margin: 8px 16px;
        }
        
        .item-content {
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between;
          align-items: start;
        }
        
        .item-title {
          flex: 1;
          min-width: 200px;
          font-size: 1.2rem;
        }
        
        .item-subtitle {
          flex: 1;
          min-width: 200px;
          margin: 0;
        }
        
        .item-details {
          flex: 2;
          min-width: 300px;
          margin: 0;
          padding: 0 1rem;
        }
        
        .tag-container {
          flex: 0 0 auto;
          margin: 0;
          justify-content: flex-end;
        }
        
        /* 頭部優化 */
        ion-header {
          padding: 0 2rem;
        }
        
        ion-toolbar {
          display: flex;
          gap: 2rem;
        }
        
        ion-searchbar {
          flex: 1;
          max-width: 400px;
        }
        
        .list-item:hover {
          transform: translateY(-2px) scale(1.01);
          box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
      }

      /* ===== 動畫效果 ===== */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .list-item {
        animation: fadeIn 0.3s ease-out;
      }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }

      .shake {
        animation: shake 0.5s ease-in-out;
      }
    </style>
  </head>
  <body>
    <ion-app>
      <ion-header>
        <ion-toolbar>
          <ion-title>主題清單</ion-title>
        </ion-toolbar>
        <ion-searchbar placeholder="搜尋..."></ion-searchbar>
        <ion-item>
          <ion-select label="分類" interface="popover">
            <ion-select-option value="">全部</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-header>

      <ion-content>
        <ion-list>
          <ion-item class="list-item">
            <div class="item-content">
              <div class="item-title">標題</div>
              <div class="item-subtitle">副標題</div>
              <div class="item-details">詳細資訊</div>
              <div class="tag-container">
                <ion-chip size="small">分類</ion-chip>
              </div>
            </div>
          </ion-item>
        </ion-list>
      </ion-content>
    </ion-app>

    <script>
      /**
       * 工具函數庫 - 提供可重用的通用功能
       */
      class AppUtils {
        /**
         * 安全地查詢 DOM 元素
         * @param {string} selector - CSS 選擇器
         * @param {HTMLElement} parent - 父元素
         * @returns {HTMLElement|null} 找到的元素或 null
         */
        static queryElement(selector, parent = document) {
          try {
            const element = parent.querySelector(selector);
            if (!element) {
              throw new Error(`元素未找到: ${selector}`);
            }
            return element;
          } catch (error) {
            console.warn(`查詢元素失敗: ${error.message}`);
            return null;
          }
        }

        /**
         * 安全地查詢多個 DOM 元素
         * @param {string} selector - CSS 選擇器
         * @param {HTMLElement} parent - 父元素
         * @returns {NodeList} 找到的元素列表
         */
        static queryElements(selector, parent = document) {
          try {
            return parent.querySelectorAll(selector);
          } catch (error) {
            console.warn(`查詢多個元素失敗: ${error.message}`);
            return [];
          }
        }

        /**
         * 創建 DOM 元素
         * @param {Object} config - 元素配置
         * @returns {HTMLElement} 創建的元素
         */
        static createElement(config) {
          const { tag, classes = '', content = '', attributes = {}, events = {} } = config;
          const element = document.createElement(tag);
          
          if (classes) element.className = classes;
          if (content) element.innerHTML = content;
          
          // 設置屬性
          Object.entries(attributes).forEach(([key, value]) => {
            element.setAttribute(key, value);
          });
          
          // 綁定事件
          Object.entries(events).forEach(([event, handler]) => {
            element.addEventListener(event, handler);
          });
          
          return element;
        }

        /**
         * 防抖函數 - 優化性能
         * @param {Function} func - 要防抖的函數
         * @param {number} wait - 等待時間(毫秒)
         * @returns {Function} 防抖後的函數
         */
        static debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        }

        /**
         * 安全執行函數
         * @param {Function} callback - 要執行的函數
         * @param {string} errorMessage - 錯誤訊息
         * @param {*} defaultValue - 預設返回值
         * @returns {*} 函數返回值或預設值
         */
        static safeExecute(callback, errorMessage = '操作執行失敗', defaultValue = null) {
          try {
            return callback();
          } catch (error) {
            console.error(`${errorMessage}:`, error);
            return defaultValue;
          }
        }

        /**
         * 深拷貝物件
         * @param {Object} obj - 要拷貝的物件
         * @returns {Object} 拷貝後的物件
         */
        static deepClone(obj) {
          return JSON.parse(JSON.stringify(obj));
        }

        /**
         * 檢查是否為空值
         * @param {*} value - 要檢查的值
         * @returns {boolean} 是否為空
         */
        static isEmpty(value) {
          return value === null || value === undefined || value === '' || 
                 (Array.isArray(value) && value.length === 0) ||
                 (typeof value === 'object' && Object.keys(value).length === 0);
        }
      }

      /**
       * 錯誤處理管理器
       */
      class ErrorHandler {
        /**
         * 顯示錯誤訊息
         * @param {string} message - 錯誤訊息
         * @param {string} details - 詳細資訊
         */
        static showError(message, details = '') {
          this.clearErrors();
          
          const errorElement = AppUtils.createElement({
            tag: 'div',
            classes: 'error-message',
            content: `
              <ion-item color="danger">
                <ion-icon name="warning" slot="start"></ion-icon>
                <ion-label>${message}</ion-label>
                ${details ? `<ion-note>${details}</ion-note>` : ''}
              </ion-item>
            `
          });
          
          const content = document.querySelector('ion-content');
          if (content) {
            content.insertBefore(errorElement, content.firstChild);
            
            // 5秒後自動清除錯誤訊息
            setTimeout(() => this.clearErrors(), 5000);
          }
        }

        /**
         * 清除所有錯誤訊息
         */
        static clearErrors() {
          const existingErrors = AppUtils.queryElements('.error-message');
          existingErrors.forEach(error => error.remove());
        }

        /**
         * 處理非同步錯誤
         * @param {Error} error - 錯誤物件
         * @param {string} context - 錯誤上下文
         */
        static handleAsyncError(error, context = '非同步操作') {
          console.error(`${context}失敗:`, error);
          this.showError(`${context}失敗`, error.message);
        }
      }

      /**
       * 資料管理器 - 負責資料操作和驗證
       */
      class DataManager {
        constructor() {
          this.items = this.initializeData();
        }

        /**
         * 初始化應用程式資料
         * @returns {Array} 項目資料陣列
         */
        initializeData() {
          return AppUtils.safeExecute(() => {
            return [
              { id: 1, title: 'Wikipedia', subtitle: '自由的網路百科全書', details: '由全球志願者協作撰寫的多語言百科全書。', tags: ['百科', '網站'] },
              { id: 2, title: 'Wikimedia Foundation', subtitle: '非營利組織', details: '支援維基百科與其他維基專案的基金會。', tags: ['組織'] },
              { id: 3, title: 'Wikidata', subtitle: '結構化資料庫', details: '提供機器可讀、可重用的結構化資料集。', tags: ['資料'] },
              { id: 4, title: 'Wikimedia Commons', subtitle: '多媒體檔案庫', details: '存放自由授權的圖片、音訊與影片。', tags: ['媒體'] },
              { id: 5, title: 'Wikibooks', subtitle: '開放教科書', details: '合作撰寫與分享開放教科書與教材。', tags: ['教育'] },
              { id: 6, title: 'Wiktionary', subtitle: '維基詞典', details: '多語言詞典，包含定義、發音與詞源。', tags: ['詞典'] },
              { id: 7, title: 'Wikiquote', subtitle: '名言與引用', details: '收錄名人名言與引用來源。', tags: ['引用'] },
              { id: 8, title: 'Wikisource', subtitle: '原始文獻庫', details: '保存公共領域或授權文本的數位文獻。', tags: ['文獻'] },
              { id: 9, title: 'Wikiversity', subtitle: '開放學習', details: '促進自由學習資源與課程開發。', tags: ['教育'] },
              { id: 10, title: 'Templates', subtitle: '樣板系統', details: '用於在頁面中重複顯示一致的資訊區塊。', tags: ['網站', '結構'] },
              { id: 11, title: 'Namespaces', subtitle: '名稱空間', details: '區分條目、討論、用戶頁等不同頁面類型。', tags: ['結構'] },
              { id: 12, title: 'Page history', subtitle: '頁面版本', details: '記錄每次編輯與變更，方便追溯與還原。', tags: ['版本'] },
              { id: 13, title: 'Talk page', subtitle: '討論頁面', details: '條目與用戶間的協作與討論場所。', tags: ['社群'] },
              { id: 14, title: 'Citations', subtitle: '引用與來源', details: '條目內容應以可靠來源支援與註明。', tags: ['引用'] },
              { id: 15, title: 'Neutral point of view', subtitle: '中立觀點', details: '要求條目以中立角度呈現，避免立場偏頗。', tags: ['政策'] },
              { id: 16, title: 'Verifiability', subtitle: '可查證性', details: '內容應可由可靠來源驗證。', tags: ['政策'] },
              { id: 17, title: 'Bots', subtitle: '自動化工具', details: '自動化執行重複性維護任務的機器人帳號。', tags: ['工具'] },
              { id: 18, title: 'Administrators', subtitle: '管理員', details: '受社群委任執行管理與維護任務的帳號。', tags: ['管理'] },
              { id: 19, title: 'Edit war', subtitle: '編輯衝突', details: '對同一內容反覆還原或爭議的編輯行為。', tags: ['社群'] },
              { id: 20, title: 'Stub', subtitle: '短條目', details: '需要擴充的短條目，會被標示為 stub。', tags: ['條目'] },
              { id: 21, title: 'Community', subtitle: '志願者社群', details: '維基計畫由全球志願者社群共同維護。', tags: ['社群'] }
            ];
          }, '資料初始化失敗', []);
        }

        /**
         * 驗證項目資料
         * @param {Object} item - 要驗證的項目
         * @returns {boolean} 是否有效
         */
        validateItem(item) {
          if (!item || typeof item !== 'object') return false;
          if (!item.title || typeof item.title !== 'string') return false;
          if (!Array.isArray(item.tags)) return false;
          return true;
        }

        /**
         * 過濾資料
         * @param {string} searchTerm - 搜尋關鍵字
         * @param {string} category - 分類
         * @returns {Array} 過濾後的資料
         */
        filterItems(searchTerm = '', category = '') {
          return AppUtils.safeExecute(() => {
            const searchTermLower = searchTerm.toLowerCase();
            
            return this.items.filter(item => {
              if (!this.validateItem(item)) return false;
              
              const matchesSearch = !searchTerm || 
                item.title.toLowerCase().includes(searchTermLower) ||
                item.subtitle.toLowerCase().includes(searchTermLower) ||
                item.details.toLowerCase().includes(searchTermLower);
              
              const matchesCategory = !category || item.tags.includes(category);
              
              return matchesSearch && matchesCategory;
            });
          }, '資料過濾失敗', []);
        }

        /**
         * 獲取所有分類
         * @returns {Array} 分類陣列
         */
        getAllCategories() {
          return AppUtils.safeExecute(() => {
            const categories = new Set();
            this.items.forEach(item => {
              if (this.validateItem(item)) {
                item.tags.forEach(tag => categories.add(tag));
              }
            });
            return Array.from(categories).sort();
          }, '獲取分類失敗', []);
        }
      }

      /**
       * UI 渲染器 - 負責所有 UI 渲染邏輯
       */
      class UIRenderer {
        constructor() {
          this.tagColorMap = this.initializeTagColorMap();
        }

        /**
         * 初始化標籤顏色映射
         * @returns {Object} 顏色映射物件
         */
        initializeTagColorMap() {
          return {
            '教育': 'success', '詞典': 'success', '學習': 'success',
            '社群': 'danger', '組織': 'danger', '管理': 'danger',
            '政策': 'warning', '結構': 'warning', '版本': 'warning',
            '媒體': 'tertiary', '資料': 'tertiary', '網站': 'tertiary',
            '百科': 'primary', '文獻': 'primary', '引用': 'primary',
            '工具': 'dark', '條目': 'secondary'
          };
        }

        /**
         * 渲染列表項目
         * @param {Object} item - 項目資料
         * @param {Function} onTagClick - 標籤點擊回調
         * @param {HTMLElement} template - 模板元素
         * @returns {HTMLElement} 渲染後的元素
         */
        renderListItem(item, onTagClick, template) {
          return AppUtils.safeExecute(() => {
            const clone = template.cloneNode(true);
            
            // 設置內容
            this.setElementText(clone, '.item-title', item.title);
            this.setElementText(clone, '.item-subtitle', item.subtitle);
            this.setElementText(clone, '.item-details', item.details);
            
            // 渲染標籤
            this.renderTags(clone, item.tags, onTagClick);
            
            return clone;
          }, '渲染列表項目失敗', document.createElement('div'));
        }

        /**
         * 設置元素文字內容
         * @param {HTMLElement} parent - 父元素
         * @param {string} selector - 選擇器
         * @param {string} text - 文字內容
         */
        setElementText(parent, selector, text) {
          const element = parent.querySelector(selector);
          if (element) {
            element.textContent = text || '';
          }
        }

        /**
         * 渲染標籤
         * @param {HTMLElement} parent - 父元素
         * @param {Array} tags - 標籤陣列
         * @param {Function} onTagClick - 點擊回調
         */
        renderTags(parent, tags, onTagClick) {
          const tagContainer = parent.querySelector('.tag-container');
          if (!tagContainer) return;
          
          tagContainer.innerHTML = '';
          
          tags.forEach(tag => {
            const chip = AppUtils.createElement({
              tag: 'ion-chip',
              attributes: { 'size': 'small' },
              events: {
                'click': () => onTagClick(tag)
              }
            });
            
            chip.textContent = tag;
            chip.color = this.tagColorMap[tag] || 'primary';
            tagContainer.appendChild(chip);
          });
        }

        /**
         * 顯示空狀態
         * @param {HTMLElement} container - 容器元素
         */
        showEmptyState(container) {
          const emptyState = AppUtils.createElement({
            tag: 'div',
            classes: 'empty-state',
            content: `
              <ion-icon name="search-outline"></ion-icon>
              <h3>沒有找到相關內容</h3>
              <p>請嘗試調整搜索條件或選擇其他分類</p>
            `
          });
          
          container.appendChild(emptyState);
        }

        /**
         * 顯示載入狀態
         * @param {HTMLElement} container - 容器元素
         */
        showLoadingState(container) {
          const loadingState = AppUtils.createElement({
            tag: 'div',
            classes: 'loading-spinner',
            content: `
              <ion-spinner name="crescent"></ion-spinner>
              <p>載入中...</p>
            `
          });
          
          container.appendChild(loadingState);
        }

        /**
         * 更新篩選狀態顯示
         * @param {string} selectedCategory - 選中的分類
         * @param {Function} onClearFilter - 清除篩選回調
         */
        updateFilterStatus(selectedCategory, onClearFilter) {
          this.removeExistingFilterStatus();
          
          if (selectedCategory) {
            const statusElement = AppUtils.createElement({
              tag: 'div',
              classes: 'filter-status',
              content: `
                <ion-item>
                  <ion-label>當前分類: ${selectedCategory}</ion-label>
                  <ion-button fill="clear" size="small" id="clear-filter">
                    <ion-icon name="close-circle" slot="icon-only"></ion-icon>
                  </ion-button>
                </ion-item>
              `,
              events: {
                'click': (e) => {
                  if (e.target.closest('#clear-filter')) {
                    onClearFilter();
                  }
                }
              }
            });
            
            const searchbar = document.querySelector('ion-searchbar');
            if (searchbar && searchbar.parentNode) {
              searchbar.parentNode.insertBefore(statusElement, searchbar.nextSibling);
            }
          }
        }

        /**
         * 移除現有的篩選狀態顯示
         */
        removeExistingFilterStatus() {
          const existingStatus = AppUtils.queryElements('.filter-status');
          existingStatus.forEach(status => status.remove());
        }

        /**
         * 填充分類選擇器
         * @param {HTMLElement} selectElement - 選擇器元素
         * @param {Array} categories - 分類陣列
         */
        populateCategorySelect(selectElement, categories) {
          return AppUtils.safeExecute(() => {
            const allOption = selectElement.querySelector('ion-select-option[value=""]');
            selectElement.innerHTML = '';
            selectElement.appendChild(allOption);
            
            categories.forEach(category => {
              const option = AppUtils.createElement({
                tag: 'ion-select-option',
                attributes: { 'value': category }
              });
              option.textContent = category;
              selectElement.appendChild(option);
            });
          }, '填充分類選擇器失敗');
        }
      }

      /**
       * 主題清單應用程式 - 主應用程式類別
       */
      class ThemeListApp {
        constructor() {
          // 初始化管理器
          this.dataManager = new DataManager();
          this.uiRenderer = new UIRenderer();
          this.isInitialized = false;
          
          // 初始化應用程式
          this.initializeApp();
        }

        /**
         * 初始化應用程式
         */
        async initializeApp() {
          try {
            // 驗證依賴
            this.validateDependencies();
            
            // 初始化 DOM 元素
            this.initializeDOMElements();
            
            // 設置事件監聽器
            this.setupEventListeners();
            
            // 初始化 UI
            await this.initializeUI();
            
            this.isInitialized = true;
            console.log('應用程式初始化完成');
            
          } catch (error) {
            ErrorHandler.handleAsyncError(error, '應用程式初始化');
          }
        }

        /**
         * 驗證應用程式依賴
         */
        validateDependencies() {
          const requiredElements = [
            'ion-searchbar',
            'ion-list', 
            '.list-item',
            'ion-select'
          ];
          
          requiredElements.forEach(selector => {
            if (!AppUtils.queryElement(selector)) {
              throw new Error(`必需的 DOM 元素不存在: ${selector}`);
            }
          });
        }

        /**
         * 初始化 DOM 元素引用
         */
        initializeDOMElements() {
          this.searchbar = AppUtils.queryElement('ion-searchbar');
          this.list = AppUtils.queryElement('ion-list');
          this.template = AppUtils.queryElement('.list-item');
          this.categorySelect = AppUtils.queryElement('ion-select');
          
          if (!this.searchbar || !this.list || !this.template || !this.categorySelect) {
            throw new Error('DOM 元素初始化失敗');
          }
        }

        /**
         * 設置事件監聽器
         */
        setupEventListeners() {
          // 防抖搜尋
          const debouncedSearch = AppUtils.debounce(() => {
            this.handleSearch();
          }, 300);
          
          this.searchbar.addEventListener('ionInput', debouncedSearch);
          this.categorySelect.addEventListener('ionChange', (event) => {
            this.handleCategoryChange(event.detail.value);
          });
        }

        /**
         * 初始化 UI
         */
        async initializeUI() {
          try {
            // 顯示載入狀態
            this.list.classList.add('loading');
            this.uiRenderer.showLoadingState(this.list);
            
            // 填充分類選擇器
            const categories = this.dataManager.getAllCategories();
            this.uiRenderer.populateCategorySelect(this.categorySelect, categories);
            
            // 更新列表
            await this.updateList();
            
            // 添加清除按鈕
            this.addClearAllButton();
            
            // 初始化視覺效果
            this.initVisualEffects();
            
            this.list.classList.remove('loading');
            
          } catch (error) {
            ErrorHandler.handleAsyncError(error, 'UI 初始化');
          }
        }

        /**
         * 處理搜尋
         */
        handleSearch() {
          if (!this.isInitialized) return;
          
          AppUtils.safeExecute(() => {
            this.updateList(this.currentCategory);
          }, '搜尋處理失敗');
        }

        /**
         * 處理分類變化
         * @param {string} selectedCategory - 選中的分類
         */
        handleCategoryChange(selectedCategory) {
          if (!this.isInitialized) return;
          
          AppUtils.safeExecute(() => {
            this.currentCategory = selectedCategory;
            this.updateList(selectedCategory);
            this.uiRenderer.updateFilterStatus(selectedCategory, () => this.clearFilters());
          }, '分類變化處理失敗');
        }

        /**
         * 更新列表顯示
         * @param {string} selectedCategory - 選中的分類
         */
        async updateList(selectedCategory = '') {
          try {
            this.list.innerHTML = '';
            
            const searchTerm = this.searchbar?.value || '';
            const filteredItems = this.dataManager.filterItems(searchTerm, selectedCategory);
            
            if (filteredItems.length === 0) {
              this.uiRenderer.showEmptyState(this.list);
              return;
            }
            
            filteredItems.forEach(item => {
              const listItem = this.uiRenderer.renderListItem(
                item, 
                (tag) => this.handleTagClick(tag),
                this.template
              );
              this.list.appendChild(listItem);
            });
            
          } catch (error) {
            ErrorHandler.handleAsyncError(error, '列表更新');
            this.uiRenderer.showEmptyState(this.list);
          }
        }

        /**
         * 處理標籤點擊
         * @param {string} tag - 點擊的標籤
         */
        handleTagClick(tag) {
          AppUtils.safeExecute(() => {
            this.categorySelect.value = tag;
            this.handleCategoryChange(tag);
          }, '標籤點擊處理失敗');
        }

        /**
         * 清除所有篩選條件
         */
        clearFilters() {
          AppUtils.safeExecute(() => {
            this.searchbar.value = '';
            this.categorySelect.value = '';
            this.currentCategory = '';
            this.updateList();
            this.uiRenderer.removeExistingFilterStatus();
          }, '清除篩選失敗');
        }

        /**
         * 添加清除所有篩選的按鈕
         */
        addClearAllButton() {
          const toolbar = AppUtils.queryElement('ion-toolbar');
          if (!toolbar) return;
          
          const clearButton = AppUtils.createElement({
            tag: 'ion-button',
            attributes: {
              'slot': 'end',
              'fill': 'clear', 
              'size': 'small'
            },
            content: '<ion-icon name="refresh" slot="icon-only"></ion-icon>',
            events: {
              'click': () => this.clearFilters()
            }
          });
          
          toolbar.appendChild(clearButton);
        }

        /**
         * 初始化視覺效果
         */
        initVisualEffects() {
          // 點擊效果
          document.addEventListener('click', (e) => {
            if (e.target.closest('.list-item')) {
              const item = e.target.closest('.list-item');
              item.style.transform = 'scale(0.98)';
              setTimeout(() => {
                item.style.transform = 'scale(1)';
              }, 150);
            }
          });

          // 搜索欄聚焦效果
          this.searchbar.addEventListener('ionFocus', () => {
            this.searchbar.style.setProperty('--box-shadow', '0 4px 12px rgba(56, 128, 255, 0.3)');
          });

          this.searchbar.addEventListener('ionBlur', () => {
            this.searchbar.style.setProperty('--box-shadow', '0 2px 6px rgba(0,0,0,0.1)');
          });
        }
      }

      // 初始化應用程式
      document.addEventListener('DOMContentLoaded', () => {
        new ThemeListApp();
      });
    </script>
  </body>
</html>