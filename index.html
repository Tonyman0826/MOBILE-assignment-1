<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>主題清單</title>
    <!-- Ionic CDN -->
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"
    ></script>
    <script
      nomodule
      src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css"
    />
<style>
  .item-content {
    width: 100%;
  }
  .item-title {
    font-weight: bold;
    margin: 0.25rem 0;
  }
  .item-subtitle {
    color: var(--ion-color-medium);
    font-size: 0.9em;
  }
  .tag-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
/* 中型螢幕 (768px以上) */
@media (min-width: 768px) {
  .list-item {
    --padding-start: 1.5rem;
    --padding-end: 1.5rem;
  }
  
  .item-title {
    font-size: 1.1rem;
  }
}

/* 大型螢幕 (992px以上) */
@media (min-width: 992px) {
  ion-app {
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .list-item {
    --padding-start: 2rem;
    --padding-end: 2rem;
  }
  
  .item-content {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: start;
  }
  
  .item-title {
    flex: 1;
    min-width: 200px;
    font-size: 1.2rem;
  }
  
  .item-subtitle {
    flex: 1;
    min-width: 200px;
    margin: 0;
  }
  
  .item-details {
    flex: 2;
    min-width: 300px;
    margin: 0;
    padding: 0 1rem;
  }
  
  .tag-container {
    flex: 0 0 auto;
    margin: 0;
    justify-content: flex-end;
  }
  
  /* 頭部優化 */
  ion-header {
    padding: 0 2rem;
  }
  
  ion-toolbar {
    display: flex;
    gap: 2rem;
  }
  
  ion-searchbar {
    flex: 1;
    max-width: 400px;
  }
}
</style>

  </head>
  <body>
    <ion-app>
      <ion-header>
        <ion-toolbar>
          <ion-title>主題清單</ion-title>
        </ion-toolbar>
        <ion-searchbar placeholder="搜尋..."></ion-searchbar>
        <ion-item>
          <ion-select label="分類" interface="popover">
            <ion-select-option value="">全部</ion-select-option>
            <!-- 根據主題加入分類選項 -->
          </ion-select>
        </ion-item>
      </ion-header>

      <ion-content>
        <ion-list>
          <!-- 清單項目範本 -->
          <ion-item class="list-item">
            <div class="item-content">
              <div class="item-title">標題</div>
              <div class="item-subtitle">副標題</div>
              <div class="item-details">詳細資訊</div>
              <div class="tag-container">
                <ion-chip size="small">分類</ion-chip>
                <!-- 標籤 -->
              </div>
            </div>
          </ion-item>
        </ion-list>
      </ion-content>
    </ion-app>
    <script>
      let searchbar = document.querySelector('ion-searchbar')
      let list = document.querySelector('ion-list')
      let template = document.querySelector('.list-item')

      // 初始化資料 (至少 20 筆與維基百科相關範例資料)
      const items = [
        { id: 1, title: 'Wikipedia', subtitle: '自由的網路百科全書', details: '由全球志願者協作撰寫的多語言百科全書。', tags: ['百科', '網站'] },
        { id: 2, title: 'Wikimedia Foundation', subtitle: '非營利組織', details: '支援維基百科與其他維基專案的基金會。', tags: ['組織'] },
        { id: 3, title: 'Wikidata', subtitle: '結構化資料庫', details: '提供機器可讀、可重用的結構化資料集。', tags: ['資料'] },
        { id: 4, title: 'Wikimedia Commons', subtitle: '多媒體檔案庫', details: '存放自由授權的圖片、音訊與影片。', tags: ['媒體'] },
        { id: 5, title: 'Wikibooks', subtitle: '開放教科書', details: '合作撰寫與分享開放教科書與教材。', tags: ['教育'] },
        { id: 6, title: 'Wiktionary', subtitle: '維基詞典', details: '多語言詞典，包含定義、發音與詞源。', tags: ['詞典'] },
        { id: 7, title: 'Wikiquote', subtitle: '名言與引用', details: '收錄名人名言與引用來源。', tags: ['引用'] },
        { id: 8, title: 'Wikisource', subtitle: '原始文獻庫', details: '保存公共領域或授權文本的數位文獻。', tags: ['文獻'] },
        { id: 9, title: 'Wikiversity', subtitle: '開放學習', details: '促進自由學習資源與課程開發。', tags: ['教育'] },
        { id: 10, title: 'Templates', subtitle: '樣板系統', details: '用於在頁面中重複顯示一致的資訊區塊。', tags: ['網站', '結構'] },
        { id: 11, title: 'Namespaces', subtitle: '名稱空間', details: '區分條目、討論、用戶頁等不同頁面類型。', tags: ['結構'] },
        { id: 12, title: 'Page history', subtitle: '頁面版本', details: '記錄每次編輯與變更，方便追溯與還原。', tags: ['版本'] },
        { id: 13, title: 'Talk page', subtitle: '討論頁面', details: '條目與用戶間的協作與討論場所。', tags: ['社群'] },
        { id: 14, title: 'Citations', subtitle: '引用與來源', details: '條目內容應以可靠來源支援與註明。', tags: ['引用'] },
        { id: 15, title: 'Neutral point of view', subtitle: '中立觀點', details: '要求條目以中立角度呈現，避免立場偏頗。', tags: ['政策'] },
        { id: 16, title: 'Verifiability', subtitle: '可查證性', details: '內容應可由可靠來源驗證。', tags: ['政策'] },
        { id: 17, title: 'Bots', subtitle: '自動化工具', details: '自動化執行重複性維護任務的機器人帳號。', tags: ['工具'] },
        { id: 18, title: 'Administrators', subtitle: '管理員', details: '受社群委任執行管理與維護任務的帳號。', tags: ['管理'] },
        { id: 19, title: 'Edit war', subtitle: '編輯衝突', details: '對同一內容反覆還原或爭議的編輯行為。', tags: ['社群'] },
        { id: 20, title: 'Stub', subtitle: '短條目', details: '需要擴充的短條目，會被標示為 stub。', tags: ['條目'] },
        { id: 21, title: 'Community', subtitle: '志願者社群', details: '維基計畫由全球志願者社群共同維護。', tags: ['社群'] }
      ]

      // 更新清單顯示
      function updateList() {
       list.innerText = '' // 清空現有清單


  for (const item of items) {
    if (
      !searchbar.value ||
            item.title
            .toLocaleLowerCase()
            .includes(searchbar.value.toLocaleLowerCase()) ||
            item.subtitle
            .toLocaleLowerCase()
            .includes(searchbar.value.toLocaleLowerCase())
        ) {
            const clone = template.cloneNode(true)
            clone.querySelector('.item-title').textContent = item.title
            clone.querySelector('.item-subtitle').textContent = item.subtitle
            clone.querySelector('.item-details').textContent = item.details
            const tagContainer = clone.querySelector('.tag-container')
            for (const tag of item.tags) {
              const chip = document.createElement('ion-chip')
              chip.textContent = tag
              tagContainer.appendChild(chip)
            }
            list.appendChild(clone)
          }
        }
      }
      updateList()
   searchbar.addEventListener('ionInput', event => {
     // 實作搜尋邏輯
     console.log(searchbar.value)
     updateList()
   })
// 获取分类选择器
let categorySelect = document.querySelector('ion-select')

// 提取所有分类标签
function getAllCategories() {
  const categories = new Set()
  items.forEach(item => {
    item.tags.forEach(tag => categories.add(tag))
  })
  return Array.from(categories).sort()
}

// 填充分类选择器选项
function populateCategorySelect() {
  const categories = getAllCategories()
  const select = document.querySelector('ion-select')
  
  // 清空现有选项（保留"全部"选项）
  const allOption = select.querySelector('ion-select-option[value=""]')
  select.innerHTML = ''
  select.appendChild(allOption)
  
  // 添加分类选项
  categories.forEach(category => {
    const option = document.createElement('ion-select-option')
    option.value = category
    option.textContent = category
    select.appendChild(option)
  })
}

// 处理分类选择变化
function handleCategoryChange(selectedCategory) {
  // 更新列表显示
  updateList(selectedCategory)
  
  // 在搜索栏下方显示当前筛选状态
  updateFilterStatus(selectedCategory)
}

// 修改updateList函数以支持分类筛选和搜索组合
function updateList(selectedCategory = '') {
  list.innerText = '' // 清空现有清单
  
  for (const item of items) {
    // 检查搜索条件
    const searchTerm = searchbar.value ? searchbar.value.toLowerCase() : ''
    const matchesSearch = !searchTerm || 
      item.title.toLowerCase().includes(searchTerm) ||
      item.subtitle.toLowerCase().includes(searchTerm) ||
      item.details.toLowerCase().includes(searchTerm)
    
    // 检查分类条件
    const matchesCategory = !selectedCategory || item.tags.includes(selectedCategory)
    
    // 只有当同时满足搜索和分类条件时才显示
    if (matchesSearch && matchesCategory) {
      const clone = template.cloneNode(true)
      clone.querySelector('.item-title').textContent = item.title
      clone.querySelector('.item-subtitle').textContent = item.subtitle
      clone.querySelector('.item-details').textContent = item.details
      
      const tagContainer = clone.querySelector('.tag-container')
      tagContainer.innerHTML = '' // 清空现有标签
      
      for (const tag of item.tags) {
        const chip = document.createElement('ion-chip')
        chip.textContent = tag
        chip.size = 'small'
        
        // 添加点击事件，点击标签切换分类
        chip.addEventListener('click', () => {
          categorySelect.value = tag
          handleCategoryChange(tag)
        })
        
        tagContainer.appendChild(chip)
      }
      
      list.appendChild(clone)
    }
  }
  
  // 如果没有匹配的项目，显示提示信息
  if (list.children.length === 0) {
    const emptyMessage = document.createElement('ion-item')
    emptyMessage.innerHTML = `
      <ion-label class="ion-text-center" style="width: 100%;">
        <h3>沒有找到匹配的項目</h3>
        <p>請嘗試調整搜索關鍵字或選擇其他分類</p>
      </ion-label>
    `
    list.appendChild(emptyMessage)
  }
}

// 添加筛选状态显示
function updateFilterStatus(selectedCategory) {
  // 移除现有的状态显示
  const existingStatus = document.querySelector('.filter-status')
  if (existingStatus) {
    existingStatus.remove()
  }
  
  // 如果有选中的分类，显示状态
  if (selectedCategory) {
    const statusElement = document.createElement('div')
    statusElement.className = 'filter-status'
    statusElement.innerHTML = `
      <ion-item>
        <ion-label>當前分類: ${selectedCategory}</ion-label>
        <ion-button fill="clear" size="small" id="clear-filter">
          <ion-icon name="close-circle" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-item>
    `
    
    // 插入到搜索栏后面
    const searchbar = document.querySelector('ion-searchbar')
    searchbar.parentNode.insertBefore(statusElement, searchbar.nextSibling)
    
    // 添加清除筛选事件
    document.getElementById('clear-filter').addEventListener('click', () => {
      categorySelect.value = ''
      updateList()
      statusElement.remove()
    })
  }
}

// 修改搜索监听器，保持当前分类选择
searchbar.addEventListener('ionInput', () => {
  const currentCategory = categorySelect.value
  updateList(currentCategory)
})

// 添加清除所有筛选的按钮（在工具栏中添加）
function addClearAllButton() {
  const toolbar = document.querySelector('ion-toolbar')
  const clearButton = document.createElement('ion-button')
  clearButton.slot = 'end'
  clearButton.fill = 'clear'
  clearButton.size = 'small'
  clearButton.innerHTML = `
    <ion-icon name="refresh" slot="icon-only"></ion-icon>
  `
  clearButton.addEventListener('click', () => {
    // 清除搜索
    searchbar.value = ''
    // 清除分类选择
    categorySelect.value = ''
    // 更新列表
    updateList()
    // 移除筛选状态显示
    const existingStatus = document.querySelector('.filter-status')
    if (existingStatus) {
      existingStatus.remove()
    }
  })
  
  toolbar.appendChild(clearButton)
}

// 初始化分类选择器
populateCategorySelect()

// 添加分类选择变化监听
categorySelect.addEventListener('ionChange', (event) => {
  handleCategoryChange(event.detail.value)
})

// 在初始化时调用
addClearAllButton()

</script>
  </body>
</html>