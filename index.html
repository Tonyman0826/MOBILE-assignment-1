<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>主題清單</title>
    <!-- Ionic CDN -->
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"
    ></script>
    <script
      nomodule
      src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css"
    />
    <style>
      /* 使用 Ionic CSS 變數 */
      :root {
        --custom-primary: #3880ff;
        --custom-primary-light: #e8f2ff;
        --custom-success: #2dd36f;
        --custom-warning: #ffc409;
        --custom-danger: #eb445a;
        --custom-medium: #92949c;
      }

      /* 自定義卡片樣式 */
      .custom-card {
        --background: white;
        --border-radius: 12px;
        margin: 8px;
        border: 1px solid var(--ion-color-light-shade);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      .search-header {
        --background: var(--custom-primary);
      }

      .category-badge {
        margin: 2px;
        font-size: 0.8em;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--custom-medium);
      }

      .empty-state ion-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        color: var(--custom-primary);
        opacity: 0.7;
      }

      .filter-status {
        background: linear-gradient(135deg, var(--custom-primary-light), white);
        border-bottom: 2px solid var(--custom-primary);
      }

      .tag-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
        justify-content: flex-end;
      }

      /* 響應式設計 */
      @media (max-width: 768px) {
        .desktop-only {
          display: none;
        }
        
        .tag-container {
          justify-content: flex-start;
          margin-top: 0.5rem;
        }
      }

      @media (min-width: 992px) {
        .custom-card {
          margin: 8px 16px;
        }
        
        .custom-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0,0,0,0.15);
          transition: all 0.3s ease;
        }
      }

      /* 動畫效果 */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in {
        animation: fadeIn 0.3s ease-out;
      }
    </style>
  </head>
  <body>
    <ion-app>
      <!-- 主頁面 -->
      <ion-header class="search-header">
        <ion-toolbar>
          <ion-title>維基主題清單</ion-title>
          
          <ion-buttons slot="end">
            <ion-button id="theme-toggle" fill="clear">
              <ion-icon slot="icon-only" name="contrast"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>

        <!-- 搜索區域 -->
        <ion-toolbar>
          <ion-searchbar 
            placeholder="搜尋主題..."
            animated="true"
            debounce="300"
            id="main-searchbar">
          </ion-searchbar>
        </ion-toolbar>

        <!-- 分類篩選 -->
        <ion-toolbar>
          <ion-segment value="all" id="category-segment">
            <ion-segment-button value="all">
              <ion-label>全部</ion-label>
            </ion-segment-button>
            <ion-segment-button value="education">
              <ion-label>教育</ion-label>
            </ion-segment-button>
            <ion-segment-button value="community">
              <ion-label>社群</ion-label>
            </ion-segment-button>
            <ion-segment-button value="tools">
              <ion-label>工具</ion-label>
            </ion-segment-button>
          </ion-segment>
        </ion-toolbar>
      </ion-header>

      <ion-content fullscreen="true">
        <!-- 響應式佈局 -->
        <ion-grid fixed>
          <ion-row>
            <!-- 桌面端側邊欄 -->
            <ion-col size="12" size-md="3" class="desktop-only">
              <ion-list>
                <ion-list-header>
                  <ion-label>快速篩選</ion-label>
                </ion-list-header>
                
                <ion-item button id="filter-all">
                  <ion-label>全部主題</ion-label>
                  <ion-badge slot="end" color="primary">21</ion-badge>
                </ion-item>
                
                <ion-item button id="filter-education">
                  <ion-label>教育學習</ion-label>
                  <ion-badge slot="end" color="success">2</ion-badge>
                </ion-item>
                
                <ion-item button id="filter-community">
                  <ion-label>社群管理</ion-label>
                  <ion-badge slot="end" color="danger">4</ion-badge>
                </ion-item>
                
                <ion-item button id="filter-tools">
                  <ion-label>工具資源</ion-label>
                  <ion-badge slot="end" color="warning">3</ion-badge>
                </ion-item>
              </ion-list>
            </ion-col>

            <!-- 主要內容區域 -->
            <ion-col size="12" size-md="9">
              <!-- 下拉刷新 -->
              <ion-refresher slot="fixed" id="content-refresher">
                <ion-refresher-content
                  pulling-icon="lines"
                  refreshing-spinner="crescent">
                </ion-refresher-content>
              </ion-refresher>

              <!-- 主題列表 -->
              <ion-list lines="full" id="theme-list">
                <!-- 列表內容由 JavaScript 動態生成 -->
              </ion-list>

              <!-- 無限滾動 -->
              <ion-infinite-scroll id="infinite-scroll">
                <ion-infinite-scroll-content
                  loading-spinner="bubbles"
                  loading-text="載入更多主題...">
                </ion-infinite-scroll-content>
              </ion-infinite-scroll>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-content>

      <!-- 浮動操作按鈕 -->
      <ion-fab vertical="bottom" horizontal="end" slot="fixed">
        <ion-fab-button id="main-fab">
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>
        <ion-fab-list side="top">
          <ion-fab-button color="success" id="fab-new">
            <ion-icon name="create"></ion-icon>
          </ion-fab-button>
          <ion-fab-button color="warning" id="fab-filter">
            <ion-icon name="filter"></ion-icon>
          </ion-fab-button>
          <ion-fab-button color="tertiary" id="fab-sort">
            <ion-icon name="swap-vertical"></ion-icon>
          </ion-fab-button>
        </ion-fab-list>
      </ion-fab>
    </ion-app>

    <!-- 設定模態框 -->
    <ion-modal trigger="theme-toggle" id="settings-modal">
      <ion-header>
        <ion-toolbar>
          <ion-title>應用程式設定</ion-title>
          <ion-buttons slot="end">
            <ion-button id="close-modal">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-list>
          <ion-list-header>
            <ion-label>外觀設定</ion-label>
          </ion-list-header>
          
          <ion-item>
            <ion-toggle id="dark-mode-toggle">
              <ion-label>暗黑模式</ion-label>
            </ion-toggle>
          </ion-item>
          
          <ion-item>
            <ion-select label="主題色彩" value="blue">
              <ion-select-option value="blue">藍色主題</ion-select-option>
              <ion-select-option value="green">綠色主題</ion-select-option>
              <ion-select-option value="purple">紫色主題</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-list>
      </ion-content>
    </ion-modal>

    <script>
      /**
       * Ionic 主題清單應用程式 - 完整整合版本
       * 結合原有功能與 Ionic 最佳實踐
       */
      class IonicThemeListApp {
        constructor() {
          this.currentTheme = 'light';
          this.filteredItems = [];
          this.allItems = this.initializeData();
          this.currentSegment = 'all';
          this.currentSearch = '';
          this.isLoading = false;
          
          // Ionic 元件引用
          this.ionElements = {};
        }

        /**
         * 初始化應用程式資料
         */
        initializeData() {
          return [
            { 
              id: 1, 
              title: 'Wikipedia', 
              subtitle: '自由的網路百科全書', 
              details: '由全球志願者協作撰寫的多語言百科全書。', 
              tags: ['百科', '網站'],
              category: 'education',
              favorite: false
            },
            { 
              id: 2, 
              title: 'Wikimedia Foundation', 
              subtitle: '非營利組織', 
              details: '支援維基百科與其他維基專案的基金會。', 
              tags: ['組織'],
              category: 'community',
              favorite: true
            },
            { 
              id: 3, 
              title: 'Wikidata', 
              subtitle: '結構化資料庫', 
              details: '提供機器可讀、可重用的結構化資料集。', 
              tags: ['資料'],
              category: 'tools',
              favorite: false
            },
            { 
              id: 4, 
              title: 'Wikimedia Commons', 
              subtitle: '多媒體檔案庫', 
              details: '存放自由授權的圖片、音訊與影片。', 
              tags: ['媒體'],
              category: 'tools',
              favorite: false
            },
            { 
              id: 5, 
              title: 'Wikibooks', 
              subtitle: '開放教科書', 
              details: '合作撰寫與分享開放教科書與教材。', 
              tags: ['教育'],
              category: 'education',
              favorite: true
            },
            { 
              id: 6, 
              title: 'Wiktionary', 
              subtitle: '維基詞典', 
              details: '多語言詞典，包含定義、發音與詞源。', 
              tags: ['詞典'],
              category: 'education',
              favorite: false
            },
            { 
              id: 7, 
              title: 'Wikiquote', 
              subtitle: '名言與引用', 
              details: '收錄名人名言與引用來源。', 
              tags: ['引用'],
              category: 'education',
              favorite: false
            },
            { 
              id: 8, 
              title: 'Wikisource', 
              subtitle: '原始文獻庫', 
              details: '保存公共領域或授權文本的數位文獻。', 
              tags: ['文獻'],
              category: 'education',
              favorite: false
            },
            { 
              id: 9, 
              title: 'Wikiversity', 
              subtitle: '開放學習', 
              details: '促進自由學習資源與課程開發。', 
              tags: ['教育'],
              category: 'education',
              favorite: false
            },
            { 
              id: 10, 
              title: 'Templates', 
              subtitle: '樣板系統', 
              details: '用於在頁面中重複顯示一致的資訊區塊。', 
              tags: ['網站', '結構'],
              category: 'tools',
              favorite: false
            },
            { 
              id: 11, 
              title: 'Namespaces', 
              subtitle: '名稱空間', 
              details: '區分條目、討論、用戶頁等不同頁面類型。', 
              tags: ['結構'],
              category: 'tools',
              favorite: false
            },
            { 
              id: 12, 
              title: 'Page history', 
              subtitle: '頁面版本', 
              details: '記錄每次編輯與變更，方便追溯與還原。', 
              tags: ['版本'],
              category: 'tools',
              favorite: false
            },
            { 
              id: 13, 
              title: 'Talk page', 
              subtitle: '討論頁面', 
              details: '條目與用戶間的協作與討論場所。', 
              tags: ['社群'],
              category: 'community',
              favorite: false
            },
            { 
              id: 14, 
              title: 'Citations', 
              subtitle: '引用與來源', 
              details: '條目內容應以可靠來源支援與註明。', 
              tags: ['引用'],
              category: 'education',
              favorite: false
            },
            { 
              id: 15, 
              title: 'Neutral point of view', 
              subtitle: '中立觀點', 
              details: '要求條目以中立角度呈現，避免立場偏頗。', 
              tags: ['政策'],
              category: 'community',
              favorite: false
            },
            { 
              id: 16, 
              title: 'Verifiability', 
              subtitle: '可查證性', 
              details: '內容應可由可靠來源驗證。', 
              tags: ['政策'],
              category: 'community',
              favorite: false
            },
            { 
              id: 17, 
              title: 'Bots', 
              subtitle: '自動化工具', 
              details: '自動化執行重複性維護任務的機器人帳號。', 
              tags: ['工具'],
              category: 'tools',
              favorite: false
            },
            { 
              id: 18, 
              title: 'Administrators', 
              subtitle: '管理員', 
              details: '受社群委任執行管理與維護任務的帳號。', 
              tags: ['管理'],
              category: 'community',
              favorite: false
            },
            { 
              id: 19, 
              title: 'Edit war', 
              subtitle: '編輯衝突', 
              details: '對同一內容反覆還原或爭議的編輯行為。', 
              tags: ['社群'],
              category: 'community',
              favorite: false
            },
            { 
              id: 20, 
              title: 'Stub', 
              subtitle: '短條目', 
              details: '需要擴充的短條目，會被標示為 stub。', 
              tags: ['條目'],
              category: 'education',
              favorite: false
            },
            { 
              id: 21, 
              title: 'Community', 
              subtitle: '志願者社群', 
              details: '維基計畫由全球志願者社群共同維護。', 
              tags: ['社群'],
              category: 'community',
              favorite: true
            }
          ];
        }

        /**
         * 初始化 Ionic 元件
         */
        async initializeIonicComponents() {
          // 等待 Ionic 元件註冊完成
          await customElements.whenDefined('ion-segment');
          
          // 獲取 Ionic 元件引用
          this.ionElements = {
            searchbar: document.querySelector('#main-searchbar'),
            segment: document.querySelector('#category-segment'),
            refresher: document.querySelector('#content-refresher'),
            infiniteScroll: document.querySelector('#infinite-scroll'),
            list: document.querySelector('#theme-list'),
            modal: document.querySelector('#settings-modal')
          };

          // 設置 Ionic 元件事件監聽器
          this.setupIonicEvents();
        }

        /**
         * 設置 Ionic 元件事件
         */
        setupIonicEvents() {
          // Ionic 搜索欄事件
          this.ionElements.searchbar.addEventListener('ionInput', (ev) => {
            this.handleSearch(ev.detail.value);
          });

          // Ionic 分段控制事件
          this.ionElements.segment.addEventListener('ionChange', (ev) => {
            this.handleSegmentChange(ev.detail.value);
          });

          // Ionic 下拉刷新事件
          this.ionElements.refresher.addEventListener('ionRefresh', (ev) => {
            this.handleRefresh(ev);
          });

          // Ionic 無限滾動事件
          this.ionElements.infiniteScroll.addEventListener('ionInfinite', (ev) => {
            this.handleInfiniteScroll(ev);
          });

          // 側邊欄篩選事件
          document.querySelectorAll('#filter-all, #filter-education, #filter-community, #filter-tools').forEach(btn => {
            btn.addEventListener('click', (ev) => {
              const filterType = ev.currentTarget.id.replace('filter-', '');
              this.handleQuickFilter(filterType);
            });
          });

          // FAB 按鈕事件
          document.querySelector('#fab-new').addEventListener('click', () => {
            this.showCreateModal();
          });

          document.querySelector('#fab-filter').addEventListener('click', () => {
            this.showAdvancedFilter();
          });

          document.querySelector('#fab-sort').addEventListener('click', () => {
            this.showSortOptions();
          });

          // 模態框事件
          document.querySelector('#close-modal').addEventListener('click', () => {
            this.ionElements.modal.dismiss();
          });

          document.querySelector('#dark-mode-toggle').addEventListener('ionChange', (ev) => {
            this.toggleTheme(ev.detail.checked);
          });
        }

        /**
         * 處理搜索
         */
        handleSearch(searchTerm) {
          this.currentSearch = searchTerm.toLowerCase();
          this.filterItems();
        }

        /**
         * 處理分段變化
         */
        handleSegmentChange(segmentValue) {
          this.currentSegment = segmentValue;
          this.filterItems();
        }

        /**
         * 處理快速篩選
         */
        handleQuickFilter(filterType) {
          this.currentSegment = filterType === 'all' ? 'all' : filterType;
          this.ionElements.segment.value = this.currentSegment;
          this.filterItems();
        }

        /**
         * 過濾項目
         */
        filterItems() {
          this.filteredItems = this.allItems.filter(item => {
            // 搜索過濾
            const matchesSearch = !this.currentSearch || 
              item.title.toLowerCase().includes(this.currentSearch) ||
              item.subtitle.toLowerCase().includes(this.currentSearch) ||
              item.details.toLowerCase().includes(this.currentSearch) ||
              item.tags.some(tag => tag.toLowerCase().includes(this.currentSearch));
            
            // 分類過濾
            const matchesCategory = this.currentSegment === 'all' || 
              item.category === this.currentSegment;
            
            return matchesSearch && matchesCategory;
          });
          
          this.renderList();
        }

        /**
         * 渲染列表
         */
        renderList() {
          const list = this.ionElements.list;
          list.innerHTML = '';

          if (this.filteredItems.length === 0) {
            this.showEmptyState();
            return;
          }

          this.filteredItems.forEach(item => {
            const ionItem = this.createListItem(item);
            list.appendChild(ionItem);
          });
        }

        /**
         * 創建列表項目
         */
        createListItem(item) {
          const ionItem = document.createElement('ion-item');
          ionItem.classList.add('custom-card', 'fade-in');
          ionItem.button = true;
          ionItem.detail = true;

          // 使用 Ionic 網格佈局
          const grid = document.createElement('ion-grid');
          const row = document.createElement('ion-row');
          const colContent = document.createElement('ion-col');
          const colTags = document.createElement('ion-col');
          
          // 響應式佈局
          colContent.size = '12';
          colContent.sizeMd = '8';
          colTags.size = '12';
          colTags.sizeMd = '4';

          // 內容區域
          const content = `
            <ion-label>
              <h2 style="font-weight: 600; margin-bottom: 4px;">${item.title}</h2>
              <p style="color: var(--ion-color-medium); margin-bottom: 8px;">${item.subtitle}</p>
              <p style="font-size: 0.9em; color: var(--ion-color-step-600); line-height: 1.4;">${item.details}</p>
            </ion-label>
          `;
          colContent.innerHTML = content;

          // 標籤區域
          const tagsContainer = document.createElement('div');
          tagsContainer.className = 'tag-container';
          
          item.tags.forEach(tag => {
            const badge = document.createElement('ion-badge');
            badge.className = 'category-badge';
            badge.textContent = tag;
            badge.color = this.getTagColor(tag);
            
            badge.addEventListener('click', (e) => {
              e.stopPropagation();
              this.handleTagClick(tag);
            });
            
            tagsContainer.appendChild(badge);
          });
          
          colTags.appendChild(tagsContainer);

          // 組合元件
          row.appendChild(colContent);
          row.appendChild(colTags);
          grid.appendChild(row);
          ionItem.appendChild(grid);

          // 點擊事件
          ionItem.addEventListener('click', () => {
            this.showItemDetail(item);
          });

          return ionItem;
        }

        /**
         * 獲取標籤顏色
         */
        getTagColor(tag) {
          const colorMap = {
            '教育': 'success',
            '詞典': 'success', 
            '學習': 'success',
            '社群': 'danger',
            '組織': 'danger',
            '管理': 'danger',
            '政策': 'warning',
            '結構': 'warning',
            '版本': 'warning',
            '媒體': 'tertiary',
            '資料': 'tertiary',
            '網站': 'tertiary',
            '百科': 'primary',
            '文獻': 'primary',
            '引用': 'primary',
            '工具': 'dark',
            '條目': 'secondary'
          };
          
          return colorMap[tag] || 'primary';
        }

        /**
         * 處理標籤點擊
         */
        handleTagClick(tag) {
          this.ionElements.searchbar.value = tag;
          this.handleSearch(tag);
          this.showToast(`已篩選標籤: ${tag}`);
        }

        /**
         * 顯示空狀態
         */
        showEmptyState() {
          const emptyState = document.createElement('div');
          emptyState.className = 'empty-state';
          emptyState.innerHTML = `
            <ion-icon name="search-outline"></ion-icon>
            <h3>沒有找到相關內容</h3>
            <p>請嘗試調整搜索條件或選擇其他分類</p>
            <ion-button fill="clear" onclick="app.handleQuickFilter('all')">
              顯示所有主題
            </ion-button>
          `;
          this.ionElements.list.appendChild(emptyState);
        }

        /**
         * 顯示項目詳情
         */
        async showItemDetail(item) {
          const actionSheet = document.createElement('ion-action-sheet');
          actionSheet.header = item.title;
          actionSheet.subHeader = item.subtitle;
          actionSheet.buttons = [
            {
              text: item.favorite ? '取消收藏' : '加入收藏',
              icon: item.favorite ? 'star-outline' : 'star',
              handler: () => this.toggleFavorite(item)
            },
            {
              text: '分享主題',
              icon: 'share',
              handler: () => this.shareItem(item)
            },
            {
              text: '查看詳情',
              icon: 'information',
              handler: () => this.viewDetails(item)
            },
            {
              text: '取消',
              icon: 'close',
              role: 'cancel'
            }
          ];

          document.body.appendChild(actionSheet);
          await actionSheet.present();
        }

        /**
         * 切換收藏狀態
         */
        async toggleFavorite(item) {
          item.favorite = !item.favorite;
          this.showToast(
            item.favorite ? '已加入收藏' : '已取消收藏',
            item.favorite ? 'success' : 'medium'
          );
          this.filterItems(); // 重新渲染以更新UI
        }

        /**
         * 分享項目
         */
        async shareItem(item) {
          if (navigator.share) {
            try {
              await navigator.share({
                title: item.title,
                text: item.details,
                url: window.location.href
              });
            } catch (error) {
              this.showToast('分享已取消', 'medium');
            }
          } else {
            this.showToast('分享功能不可用', 'warning');
          }
        }

        /**
         * 查看詳情
         */
        viewDetails(item) {
          this.showToast(`查看 ${item.title} 的詳細資訊`, 'primary');
          // 這裡可以實現導航到詳情頁面
        }

        /**
         * 顯示 Ionic 吐司
         */
        async showToast(message, color = 'primary') {
          const toast = document.createElement('ion-toast');
          toast.message = message;
          toast.duration = 2000;
          toast.color = color;
          toast.position = 'bottom';

          document.body.appendChild(toast);
          await toast.present();
        }

        /**
         * 處理下拉刷新
         */
        async handleRefresh(event) {
          const loading = await this.showLoading('重新整理中...');
          
          try {
            // 模擬網路請求
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // 重新過濾資料
            this.filterItems();
            
            await this.showToast('重新整理完成', 'success');
          } catch (error) {
            await this.showToast('重新整理失敗', 'danger');
          } finally {
            loading.dismiss();
            event.target.complete();
          }
        }

        /**
         * 處理無限滾動
         */
        async handleInfiniteScroll(event) {
          // 模擬載入更多資料
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          // 這裡可以實現載入更多資料的邏輯
          // this.loadMoreData();
          
          event.target.complete();
          
          // 如果沒有更多資料，禁用無限滾動
          if (this.filteredItems.length >= 50) {
            event.target.disabled = true;
          }
        }

        /**
         * 顯示載入中
         */
        async showLoading(message = '載入中...') {
          const loading = document.createElement('ion-loading');
          loading.message = message;
          loading.spinner = 'crescent';

          document.body.appendChild(loading);
          await loading.present();
          
          return loading;
        }

        /**
         * 切換主題
         */
        toggleTheme(isDark) {
          this.currentTheme = isDark ? 'dark' : 'light';
          document.body.classList.toggle('ion-palette-dark', isDark);
          this.showToast(`已切換到${isDark ? '深色' : '淺色'}主題`);
        }

        /**
         * 顯示創建模態框
         */
        showCreateModal() {
          this.showToast('創建新主題功能', 'primary');
        }

        /**
         * 顯示進階篩選
         */
        showAdvancedFilter() {
          this.showToast('進階篩選功能', 'primary');
        }

        /**
         * 顯示排序選項
         */
        showSortOptions() {
          this.showToast('排序選項功能', 'primary');
        }

        /**
         * 初始化應用程式
         */
        async initializeApp() {
          try {
            await this.initializeIonicComponents();
            this.filterItems(); // 初始過濾
            
            console.log('Ionic 主題清單應用程式初始化完成');
          } catch (error) {
            console.error('應用程式初始化失敗:', error);
            this.showToast('應用程式初始化失敗', 'danger');
          }
        }
      }

      // 全局應用程式實例
      let app;

      // 初始化應用程式
      document.addEventListener('DOMContentLoaded', async () => {
        app = new IonicThemeListApp();
        await app.initializeApp();
      });
    </script>
  </body>
</html>